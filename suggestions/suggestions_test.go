package suggestions

import (
	"context"
	"github.com/dmalykh/dadata/request"
	"net/http"
	"net/http/httptest"
	"testing"
)

func TestGetInstance(t *testing.T) {
	var r request.DadataRequest
	if GetInstance(&r) == nil {
		t.Fatalf(`Can't execute GetInstance().`)
	}
}

func TestSuggestions_Address(t *testing.T) {
	type testCase struct {
		Name     string
		Count    int
		Need     int
		Response string
	}
	var r = GetInstance(&request.DadataRequest{
		Handle: func(c request.DadataRequest, w *interface{}) error {
			return request.DefaultHandler(c, w)
		},
	})
	var ctx = context.Background()

	var cases = []testCase{
		{
			Name:     "Москва г, Широкая 1 1",
			Count:    10,
			Need:     10,
			Response: `{"suggestions":[{"value":"г Москва, ул Широкая, д 1А","unrestricted_value":"г Москва, ул Широкая, д 1А","data":{"postal_code":"127282","country":"Россия","region_fias_id":"0c5b2444-70a0-4932-980c-b4dc0d3f02b5","region_kladr_id":"7700000000000","region_with_type":"г Москва","region_type":"г","region_type_full":"город","region":"Москва","area_fias_id":null,"area_kladr_id":null,"area_with_type":null,"area_type":null,"area_type_full":null,"area":null,"city_fias_id":"0c5b2444-70a0-4932-980c-b4dc0d3f02b5","city_kladr_id":"7700000000000","city_with_type":"г Москва","city_type":"г","city_type_full":"город","city":"Москва","city_area":null,"city_district_fias_id":null,"city_district_kladr_id":null,"city_district_with_type":null,"city_district_type":null,"city_district_type_full":null,"city_district":null,"settlement_fias_id":null,"settlement_kladr_id":null,"settlement_with_type":null,"settlement_type":null,"settlement_type_full":null,"settlement":null,"street_fias_id":"0031d949-d7d4-4771-ac46-1a6f843297c0","street_kladr_id":"77000000000314800","street_with_type":"ул Широкая","street_type":"ул","street_type_full":"улица","street":"Широкая","house_fias_id":"2915395e-7e78-4720-91a8-5ddaddd19ef9","house_kladr_id":"7700000000031480067","house_type":"д","house_type_full":"дом","house":"1А","block_type":null,"block_type_full":null,"block":null,"flat_type":null,"flat_type_full":null,"flat":null,"flat_area":null,"square_meter_price":null,"flat_price":null,"postal_box":null,"fias_id":"2915395e-7e78-4720-91a8-5ddaddd19ef9","fias_code":null,"fias_level":"8","fias_actuality_state":null,"kladr_id":"7700000000031480067","geoname_id":null,"capital_marker":"0","okato":"45280583000","oktmo":"45362000","tax_office":"7715","tax_office_legal":"7715","timezone":null,"geo_lat":null,"geo_lon":null,"beltway_hit":null,"beltway_distance":null,"metro":null,"qc_geo":null,"qc_complete":null,"qc_house":null,"history_values":null,"unparsed_parts":null,"source":null,"qc":null}},{"value":"г Москва, ул Широкая, д 1 к 1","unrestricted_value":"г Москва, ул Широкая, д 1 к 1","data":{"postal_code":"127282","country":"Россия","region_fias_id":"0c5b2444-70a0-4932-980c-b4dc0d3f02b5","region_kladr_id":"7700000000000","region_with_type":"г Москва","region_type":"г","region_type_full":"город","region":"Москва","area_fias_id":null,"area_kladr_id":null,"area_with_type":null,"area_type":null,"area_type_full":null,"area":null,"city_fias_id":"0c5b2444-70a0-4932-980c-b4dc0d3f02b5","city_kladr_id":"7700000000000","city_with_type":"г Москва","city_type":"г","city_type_full":"город","city":"Москва","city_area":null,"city_district_fias_id":null,"city_district_kladr_id":null,"city_district_with_type":null,"city_district_type":null,"city_district_type_full":null,"city_district":null,"settlement_fias_id":null,"settlement_kladr_id":null,"settlement_with_type":null,"settlement_type":null,"settlement_type_full":null,"settlement":null,"street_fias_id":"0031d949-d7d4-4771-ac46-1a6f843297c0","street_kladr_id":"77000000000314800","street_with_type":"ул Широкая","street_type":"ул","street_type_full":"улица","street":"Широкая","house_fias_id":"f6984888-fad7-4345-ab7d-ee62fe404949","house_kladr_id":"7700000000031480057","house_type":"д","house_type_full":"дом","house":"1","block_type":"к","block_type_full":"корпус","block":"1","flat_type":null,"flat_type_full":null,"flat":null,"flat_area":null,"square_meter_price":null,"flat_price":null,"postal_box":null,"fias_id":"f6984888-fad7-4345-ab7d-ee62fe404949","fias_code":null,"fias_level":"8","fias_actuality_state":null,"kladr_id":"7700000000031480057","geoname_id":null,"capital_marker":"0","okato":"45280583000","oktmo":"45362000","tax_office":"7715","tax_office_legal":"7715","timezone":null,"geo_lat":null,"geo_lon":null,"beltway_hit":null,"beltway_distance":null,"metro":null,"qc_geo":null,"qc_complete":null,"qc_house":null,"history_values":null,"unparsed_parts":null,"source":null,"qc":null}},{"value":"г Москва, ул Широкая, д 1 к 2","unrestricted_value":"г Москва, ул Широкая, д 1 к 2","data":{"postal_code":"127282","country":"Россия","region_fias_id":"0c5b2444-70a0-4932-980c-b4dc0d3f02b5","region_kladr_id":"7700000000000","region_with_type":"г Москва","region_type":"г","region_type_full":"город","region":"Москва","area_fias_id":null,"area_kladr_id":null,"area_with_type":null,"area_type":null,"area_type_full":null,"area":null,"city_fias_id":"0c5b2444-70a0-4932-980c-b4dc0d3f02b5","city_kladr_id":"7700000000000","city_with_type":"г Москва","city_type":"г","city_type_full":"город","city":"Москва","city_area":null,"city_district_fias_id":null,"city_district_kladr_id":null,"city_district_with_type":null,"city_district_type":null,"city_district_type_full":null,"city_district":null,"settlement_fias_id":null,"settlement_kladr_id":null,"settlement_with_type":null,"settlement_type":null,"settlement_type_full":null,"settlement":null,"street_fias_id":"0031d949-d7d4-4771-ac46-1a6f843297c0","street_kladr_id":"77000000000314800","street_with_type":"ул Широкая","street_type":"ул","street_type_full":"улица","street":"Широкая","house_fias_id":"68ed9205-e9e7-423c-88cf-93c23c4e8861","house_kladr_id":"7700000000031480060","house_type":"д","house_type_full":"дом","house":"1","block_type":"к","block_type_full":"корпус","block":"2","flat_type":null,"flat_type_full":null,"flat":null,"flat_area":null,"square_meter_price":null,"flat_price":null,"postal_box":null,"fias_id":"68ed9205-e9e7-423c-88cf-93c23c4e8861","fias_code":null,"fias_level":"8","fias_actuality_state":null,"kladr_id":"7700000000031480060","geoname_id":null,"capital_marker":"0","okato":"45280583000","oktmo":"45362000","tax_office":"7715","tax_office_legal":"7715","timezone":null,"geo_lat":null,"geo_lon":null,"beltway_hit":null,"beltway_distance":null,"metro":null,"qc_geo":null,"qc_complete":null,"qc_house":null,"history_values":null,"unparsed_parts":null,"source":null,"qc":null}},{"value":"г Москва, ул Широкая, д 1 к 3","unrestricted_value":"г Москва, ул Широкая, д 1 к 3","data":{"postal_code":"127282","country":"Россия","region_fias_id":"0c5b2444-70a0-4932-980c-b4dc0d3f02b5","region_kladr_id":"7700000000000","region_with_type":"г Москва","region_type":"г","region_type_full":"город","region":"Москва","area_fias_id":null,"area_kladr_id":null,"area_with_type":null,"area_type":null,"area_type_full":null,"area":null,"city_fias_id":"0c5b2444-70a0-4932-980c-b4dc0d3f02b5","city_kladr_id":"7700000000000","city_with_type":"г Москва","city_type":"г","city_type_full":"город","city":"Москва","city_area":null,"city_district_fias_id":null,"city_district_kladr_id":null,"city_district_with_type":null,"city_district_type":null,"city_district_type_full":null,"city_district":null,"settlement_fias_id":null,"settlement_kladr_id":null,"settlement_with_type":null,"settlement_type":null,"settlement_type_full":null,"settlement":null,"street_fias_id":"0031d949-d7d4-4771-ac46-1a6f843297c0","street_kladr_id":"77000000000314800","street_with_type":"ул Широкая","street_type":"ул","street_type_full":"улица","street":"Широкая","house_fias_id":"349deb12-547c-4446-b377-d2edbb673874","house_kladr_id":"7700000000031480063","house_type":"д","house_type_full":"дом","house":"1","block_type":"к","block_type_full":"корпус","block":"3","flat_type":null,"flat_type_full":null,"flat":null,"flat_area":null,"square_meter_price":null,"flat_price":null,"postal_box":null,"fias_id":"349deb12-547c-4446-b377-d2edbb673874","fias_code":null,"fias_level":"8","fias_actuality_state":null,"kladr_id":"7700000000031480063","geoname_id":null,"capital_marker":"0","okato":"45280583000","oktmo":"45362000","tax_office":"7715","tax_office_legal":"7715","timezone":null,"geo_lat":null,"geo_lon":null,"beltway_hit":null,"beltway_distance":null,"metro":null,"qc_geo":null,"qc_complete":null,"qc_house":null,"history_values":null,"unparsed_parts":null,"source":null,"qc":null}},{"value":"г Москва, ул Широкая, д 1 к 4","unrestricted_value":"г Москва, ул Широкая, д 1 к 4","data":{"postal_code":"127282","country":"Россия","region_fias_id":"0c5b2444-70a0-4932-980c-b4dc0d3f02b5","region_kladr_id":"7700000000000","region_with_type":"г Москва","region_type":"г","region_type_full":"город","region":"Москва","area_fias_id":null,"area_kladr_id":null,"area_with_type":null,"area_type":null,"area_type_full":null,"area":null,"city_fias_id":"0c5b2444-70a0-4932-980c-b4dc0d3f02b5","city_kladr_id":"7700000000000","city_with_type":"г Москва","city_type":"г","city_type_full":"город","city":"Москва","city_area":null,"city_district_fias_id":null,"city_district_kladr_id":null,"city_district_with_type":null,"city_district_type":null,"city_district_type_full":null,"city_district":null,"settlement_fias_id":null,"settlement_kladr_id":null,"settlement_with_type":null,"settlement_type":null,"settlement_type_full":null,"settlement":null,"street_fias_id":"0031d949-d7d4-4771-ac46-1a6f843297c0","street_kladr_id":"77000000000314800","street_with_type":"ул Широкая","street_type":"ул","street_type_full":"улица","street":"Широкая","house_fias_id":"02aca099-1239-4407-91f0-9904fbf5d074","house_kladr_id":"7700000000031480064","house_type":"д","house_type_full":"дом","house":"1","block_type":"к","block_type_full":"корпус","block":"4","flat_type":null,"flat_type_full":null,"flat":null,"flat_area":null,"square_meter_price":null,"flat_price":null,"postal_box":null,"fias_id":"02aca099-1239-4407-91f0-9904fbf5d074","fias_code":null,"fias_level":"8","fias_actuality_state":null,"kladr_id":"7700000000031480064","geoname_id":null,"capital_marker":"0","okato":"45280583000","oktmo":"45362000","tax_office":"7715","tax_office_legal":"7715","timezone":null,"geo_lat":null,"geo_lon":null,"beltway_hit":null,"beltway_distance":null,"metro":null,"qc_geo":null,"qc_complete":null,"qc_house":null,"history_values":null,"unparsed_parts":null,"source":null,"qc":null}},{"value":"г Москва, ул Широкая, д 1 к 5","unrestricted_value":"г Москва, ул Широкая, д 1 к 5","data":{"postal_code":"127282","country":"Россия","region_fias_id":"0c5b2444-70a0-4932-980c-b4dc0d3f02b5","region_kladr_id":"7700000000000","region_with_type":"г Москва","region_type":"г","region_type_full":"город","region":"Москва","area_fias_id":null,"area_kladr_id":null,"area_with_type":null,"area_type":null,"area_type_full":null,"area":null,"city_fias_id":"0c5b2444-70a0-4932-980c-b4dc0d3f02b5","city_kladr_id":"7700000000000","city_with_type":"г Москва","city_type":"г","city_type_full":"город","city":"Москва","city_area":null,"city_district_fias_id":null,"city_district_kladr_id":null,"city_district_with_type":null,"city_district_type":null,"city_district_type_full":null,"city_district":null,"settlement_fias_id":null,"settlement_kladr_id":null,"settlement_with_type":null,"settlement_type":null,"settlement_type_full":null,"settlement":null,"street_fias_id":"0031d949-d7d4-4771-ac46-1a6f843297c0","street_kladr_id":"77000000000314800","street_with_type":"ул Широкая","street_type":"ул","street_type_full":"улица","street":"Широкая","house_fias_id":"832ef7db-9663-44d6-8cb7-cf51df20442e","house_kladr_id":"7700000000031480065","house_type":"д","house_type_full":"дом","house":"1","block_type":"к","block_type_full":"корпус","block":"5","flat_type":null,"flat_type_full":null,"flat":null,"flat_area":null,"square_meter_price":null,"flat_price":null,"postal_box":null,"fias_id":"832ef7db-9663-44d6-8cb7-cf51df20442e","fias_code":null,"fias_level":"8","fias_actuality_state":null,"kladr_id":"7700000000031480065","geoname_id":null,"capital_marker":"0","okato":"45280583000","oktmo":"45362000","tax_office":"7715","tax_office_legal":"7715","timezone":null,"geo_lat":null,"geo_lon":null,"beltway_hit":null,"beltway_distance":null,"metro":null,"qc_geo":null,"qc_complete":null,"qc_house":null,"history_values":null,"unparsed_parts":null,"source":null,"qc":null}},{"value":"г Москва, ул Широкая, д 2 к 1","unrestricted_value":"г Москва, ул Широкая, д 2 к 1","data":{"postal_code":"127282","country":"Россия","region_fias_id":"0c5b2444-70a0-4932-980c-b4dc0d3f02b5","region_kladr_id":"7700000000000","region_with_type":"г Москва","region_type":"г","region_type_full":"город","region":"Москва","area_fias_id":null,"area_kladr_id":null,"area_with_type":null,"area_type":null,"area_type_full":null,"area":null,"city_fias_id":"0c5b2444-70a0-4932-980c-b4dc0d3f02b5","city_kladr_id":"7700000000000","city_with_type":"г Москва","city_type":"г","city_type_full":"город","city":"Москва","city_area":null,"city_district_fias_id":null,"city_district_kladr_id":null,"city_district_with_type":null,"city_district_type":null,"city_district_type_full":null,"city_district":null,"settlement_fias_id":null,"settlement_kladr_id":null,"settlement_with_type":null,"settlement_type":null,"settlement_type_full":null,"settlement":null,"street_fias_id":"0031d949-d7d4-4771-ac46-1a6f843297c0","street_kladr_id":"77000000000314800","street_with_type":"ул Широкая","street_type":"ул","street_type_full":"улица","street":"Широкая","house_fias_id":"5f72befd-c55d-4268-a0e1-d7152095ee29","house_kladr_id":"7700000000031480068","house_type":"д","house_type_full":"дом","house":"2","block_type":"к","block_type_full":"корпус","block":"1","flat_type":null,"flat_type_full":null,"flat":null,"flat_area":null,"square_meter_price":null,"flat_price":null,"postal_box":null,"fias_id":"5f72befd-c55d-4268-a0e1-d7152095ee29","fias_code":null,"fias_level":"8","fias_actuality_state":null,"kladr_id":"7700000000031480068","geoname_id":null,"capital_marker":"0","okato":"45280583000","oktmo":"45362000","tax_office":"7715","tax_office_legal":"7715","timezone":null,"geo_lat":null,"geo_lon":null,"beltway_hit":null,"beltway_distance":null,"metro":null,"qc_geo":null,"qc_complete":null,"qc_house":null,"history_values":null,"unparsed_parts":null,"source":null,"qc":null}},{"value":"г Москва, ул Широкая, д 3 к 1","unrestricted_value":"г Москва, ул Широкая, д 3 к 1","data":{"postal_code":"127282","country":"Россия","region_fias_id":"0c5b2444-70a0-4932-980c-b4dc0d3f02b5","region_kladr_id":"7700000000000","region_with_type":"г Москва","region_type":"г","region_type_full":"город","region":"Москва","area_fias_id":null,"area_kladr_id":null,"area_with_type":null,"area_type":null,"area_type_full":null,"area":null,"city_fias_id":"0c5b2444-70a0-4932-980c-b4dc0d3f02b5","city_kladr_id":"7700000000000","city_with_type":"г Москва","city_type":"г","city_type_full":"город","city":"Москва","city_area":null,"city_district_fias_id":null,"city_district_kladr_id":null,"city_district_with_type":null,"city_district_type":null,"city_district_type_full":null,"city_district":null,"settlement_fias_id":null,"settlement_kladr_id":null,"settlement_with_type":null,"settlement_type":null,"settlement_type_full":null,"settlement":null,"street_fias_id":"0031d949-d7d4-4771-ac46-1a6f843297c0","street_kladr_id":"77000000000314800","street_with_type":"ул Широкая","street_type":"ул","street_type_full":"улица","street":"Широкая","house_fias_id":"c4e37bb5-4aee-408a-b64f-908d2e54d30d","house_kladr_id":"7700000000031480074","house_type":"д","house_type_full":"дом","house":"3","block_type":"к","block_type_full":"корпус","block":"1","flat_type":null,"flat_type_full":null,"flat":null,"flat_area":null,"square_meter_price":null,"flat_price":null,"postal_box":null,"fias_id":"c4e37bb5-4aee-408a-b64f-908d2e54d30d","fias_code":null,"fias_level":"8","fias_actuality_state":null,"kladr_id":"7700000000031480074","geoname_id":null,"capital_marker":"0","okato":"45280583000","oktmo":"45362000","tax_office":"7715","tax_office_legal":"7715","timezone":null,"geo_lat":null,"geo_lon":null,"beltway_hit":null,"beltway_distance":null,"metro":null,"qc_geo":null,"qc_complete":null,"qc_house":null,"history_values":null,"unparsed_parts":null,"source":null,"qc":null}},{"value":"г Москва, ул Широкая, д 4 к 1","unrestricted_value":"г Москва, ул Широкая, д 4 к 1","data":{"postal_code":"127282","country":"Россия","region_fias_id":"0c5b2444-70a0-4932-980c-b4dc0d3f02b5","region_kladr_id":"7700000000000","region_with_type":"г Москва","region_type":"г","region_type_full":"город","region":"Москва","area_fias_id":null,"area_kladr_id":null,"area_with_type":null,"area_type":null,"area_type_full":null,"area":null,"city_fias_id":"0c5b2444-70a0-4932-980c-b4dc0d3f02b5","city_kladr_id":"7700000000000","city_with_type":"г Москва","city_type":"г","city_type_full":"город","city":"Москва","city_area":null,"city_district_fias_id":null,"city_district_kladr_id":null,"city_district_with_type":null,"city_district_type":null,"city_district_type_full":null,"city_district":null,"settlement_fias_id":null,"settlement_kladr_id":null,"settlement_with_type":null,"settlement_type":null,"settlement_type_full":null,"settlement":null,"street_fias_id":"0031d949-d7d4-4771-ac46-1a6f843297c0","street_kladr_id":"77000000000314800","street_with_type":"ул Широкая","street_type":"ул","street_type_full":"улица","street":"Широкая","house_fias_id":"d231274a-77de-4949-9b42-96c3057a1af5","house_kladr_id":"7700000000031480081","house_type":"д","house_type_full":"дом","house":"4","block_type":"к","block_type_full":"корпус","block":"1","flat_type":null,"flat_type_full":null,"flat":null,"flat_area":null,"square_meter_price":null,"flat_price":null,"postal_box":null,"fias_id":"d231274a-77de-4949-9b42-96c3057a1af5","fias_code":null,"fias_level":"8","fias_actuality_state":null,"kladr_id":"7700000000031480081","geoname_id":null,"capital_marker":"0","okato":"45280583000","oktmo":"45362000","tax_office":"7715","tax_office_legal":"7715","timezone":null,"geo_lat":null,"geo_lon":null,"beltway_hit":null,"beltway_distance":null,"metro":null,"qc_geo":null,"qc_complete":null,"qc_house":null,"history_values":null,"unparsed_parts":null,"source":null,"qc":null}},{"value":"г Москва, ул Широкая, д 5 к 1","unrestricted_value":"г Москва, ул Широкая, д 5 к 1","data":{"postal_code":"127282","country":"Россия","region_fias_id":"0c5b2444-70a0-4932-980c-b4dc0d3f02b5","region_kladr_id":"7700000000000","region_with_type":"г Москва","region_type":"г","region_type_full":"город","region":"Москва","area_fias_id":null,"area_kladr_id":null,"area_with_type":null,"area_type":null,"area_type_full":null,"area":null,"city_fias_id":"0c5b2444-70a0-4932-980c-b4dc0d3f02b5","city_kladr_id":"7700000000000","city_with_type":"г Москва","city_type":"г","city_type_full":"город","city":"Москва","city_area":null,"city_district_fias_id":null,"city_district_kladr_id":null,"city_district_with_type":null,"city_district_type":null,"city_district_type_full":null,"city_district":null,"settlement_fias_id":null,"settlement_kladr_id":null,"settlement_with_type":null,"settlement_type":null,"settlement_type_full":null,"settlement":null,"street_fias_id":"0031d949-d7d4-4771-ac46-1a6f843297c0","street_kladr_id":"77000000000314800","street_with_type":"ул Широкая","street_type":"ул","street_type_full":"улица","street":"Широкая","house_fias_id":"29e0ac22-be25-4918-874a-1f5e99f7c708","house_kladr_id":"7700000000031480084","house_type":"д","house_type_full":"дом","house":"5","block_type":"к","block_type_full":"корпус","block":"1","flat_type":null,"flat_type_full":null,"flat":null,"flat_area":null,"square_meter_price":null,"flat_price":null,"postal_box":null,"fias_id":"29e0ac22-be25-4918-874a-1f5e99f7c708","fias_code":null,"fias_level":"8","fias_actuality_state":null,"kladr_id":"7700000000031480084","geoname_id":null,"capital_marker":"0","okato":"45280583000","oktmo":"45362000","tax_office":"7715","tax_office_legal":"7715","timezone":null,"geo_lat":null,"geo_lon":null,"beltway_hit":null,"beltway_distance":null,"metro":null,"qc_geo":null,"qc_complete":null,"qc_house":null,"history_values":null,"unparsed_parts":null,"source":null,"qc":null}}]}`,
		},
		{
			Name:     "Москва, Широкая 1 1 к 94",
			Count:    10,
			Need:     1,
			Response: `{"suggestions":[{"value":"г Москва, ул Широкая, д 1 к 94","unrestricted_value":"г Москва, р-н Северное Медведково, ул Широкая, д 1 к 94","data":{"postal_code":"127282","country":"Россия","region_fias_id":"0c5b2444-70a0-4932-980c-b4dc0d3f02b5","region_kladr_id":"7700000000000","region_with_type":"г Москва","region_type":"г","region_type_full":"город","region":"Москва","area_fias_id":null,"area_kladr_id":null,"area_with_type":null,"area_type":null,"area_type_full":null,"area":null,"city_fias_id":"0c5b2444-70a0-4932-980c-b4dc0d3f02b5","city_kladr_id":"7700000000000","city_with_type":"г Москва","city_type":"г","city_type_full":"город","city":"Москва","city_area":"Северо-восточный","city_district_fias_id":null,"city_district_kladr_id":null,"city_district_with_type":"р-н Северное Медведково","city_district_type":"р-н","city_district_type_full":"район","city_district":"Северное Медведково","settlement_fias_id":null,"settlement_kladr_id":null,"settlement_with_type":null,"settlement_type":null,"settlement_type_full":null,"settlement":null,"street_fias_id":"0031d949-d7d4-4771-ac46-1a6f843297c0","street_kladr_id":"77000000000314800","street_with_type":"ул Широкая","street_type":"ул","street_type_full":"улица","street":"Широкая","house_fias_id":null,"house_kladr_id":null,"house_type":"д","house_type_full":"дом","house":"1","block_type":"к","block_type_full":"корпус","block":"94","flat_type":null,"flat_type_full":null,"flat":null,"flat_area":null,"square_meter_price":null,"flat_price":null,"postal_box":null,"fias_id":"0031d949-d7d4-4771-ac46-1a6f843297c0","fias_code":"77000000000000031480000","fias_level":"7","fias_actuality_state":"0","kladr_id":"77000000000314800","geoname_id":null,"capital_marker":"0","okato":"45280583000","oktmo":"45362000","tax_office":"7715","tax_office_legal":"7715","timezone":null,"geo_lat":"55.8894715","geo_lon":"37.652837","beltway_hit":null,"beltway_distance":null,"metro":null,"qc_geo":"1","qc_complete":null,"qc_house":null,"history_values":null,"unparsed_parts":null,"source":"Москва, Широкая 1 1 к 94","qc":null}}]}`,
		},
	}
	for _, c := range cases {

		var server = httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
			if r.URL.Path == "/suggestions/address" {
				w.WriteHeader(http.StatusOK)
				w.Write([]byte(c.Response))
			}
		}))
		DADATA_SUGGESTIONS_URL = server.URL + "/suggestions/%s"

		items, err := r.Address(ctx, c.Name, c.Count)
		if err != nil {
			t.Errorf(`Can't receive "%s" "%d": %s`, c.Name, c.Count, err.Error())
		}
		if len(items) != c.Need {
			t.Errorf(`Waiting for "%s" %d values, got %d.`, c.Name, c.Need, len(items))
		}

		server.Close()
	}
}
